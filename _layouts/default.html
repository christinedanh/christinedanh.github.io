<!DOCTYPE html>
<html lang="{{ site.lang | default: " en-US" }}">

<head>
  <!-- google analytics -->
  {% if site.google-analytics %}
    {% include google-analytics.html %}
  {% endif %}

  <!-- Jekyll SEO plugin -->
  {% seo %}

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <title>{{ site.title }}</title>
  <link rel="shortcut icon" type="image/x-icon" href="{{ "/favicon.ico" | prepend: site.baseurl }}" >

  <!-- TailwindCSS and Inter Font-->
  <link rel="stylesheet" href="{{site.baseurl}}/assets/css/main.css">
  <link rel="stylesheet" href="{{site.baseurl}}/assets/css/tailwind.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@700&family=Red+Hat+Text:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- fontawesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
    integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous">

  <!-- highlight.js -->
  <link rel="stylesheet"
    href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/github-dark-dimmed.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>

  <!-- MathJax -->
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
    };
  </script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
 </head>

<body class="font-sans mx-auto bg-white-almost">
  <div data-scroller>
    <header data-header class="sticky top-0 z-50 h-[110px] bg-dark-primary justify-center items-center hidden">
      <img class="h-[96px]" src="{{site.baseurl}}/assets/img/stride-process-1.png"></img>
    </header>
    <div class="pt-12 pb-4">
      {{ content }}
    </div>
  </div>
</body>

<script>
  /* Funtion for getting the current year in the footer */
  (function () {
    if (document.getElementById("get-current-year")) {
      document.getElementById(
        "get-current-year"
      ).innerHTML = new Date().getFullYear();
    }

    const header = document.querySelector('[data-header]')
    const sections = [...document.querySelectorAll('[data-section]')]
    const scrollRoot = document.querySelector('[data-scroller]')
    const headerLinks = [...document.querySelectorAll('[data-link]')]

    console.log(header);
    console.log(sections);
    console.log(scrollRoot);

    let prevYPosition = 0
    let direction = 'up'

    const options = {
      root: null,
      rootMargin: '-50px',
      threshold: 0
    }

    const getTargetSection = (entry) => {
      const index = sections.findIndex((section) => section == entry.target)

      if (index >= sections.length - 1) {
      return entry.target
      } else {
      return sections[index + 1]
      }
    }

    const updateColors = (target) => {
      const theme = target.dataset.section
      header.setAttribute('data-theme', theme)
    }

    const shouldUpdate = (entry) => {
      if (direction === 'down' && !entry.isIntersecting) {
        return true
      }

      if (direction === 'up' && entry.isIntersecting) {
        return true
      }

      return false
    }

    const updateMarker = (target) => {
      const id = target.id

      if (!id) return

      let link = headerLinks.find((el) => {
        return el.getAttribute('href') === `#${id}`
      })

      link = link || headerLinks[0]

      const distanceFromLeft = link.getBoundingClientRect().left

      header.style.setProperty('--markerWidth', `${link.clientWidth}px`)
      header.style.setProperty('--markerLeft', `${distanceFromLeft}px`)
    }

    const onIntersect = (entries, observer) => {
      entries.forEach((entry) => {
        if (scrollRoot.scrollTop > prevYPosition) {
          direction = 'down'
        } else {
          direction = 'up'
        }

        prevYPosition = scrollRoot.scrollTop

        const target = direction === 'down' ? getTargetSection(entry) : entry.target

        console.log('update');
        if (shouldUpdate(entry)) {
          // updateColors(target)
          // updateMarker(target)
        }
      })
    }

    document.addEventListener('readystatechange', e => {
      if (e.target.readyState === 'complete') {
        updateMarker(sections[0])
      }
    })

    const observer = new IntersectionObserver(onIntersect, options)

    sections.forEach((section) => {
      observer.observe(section)
    })

  })();

  /* Function for opning navbar on mobile */
  function toggleNavbar(collapseID) {
    document.getElementById(collapseID).classList.toggle("hidden");
    document.getElementById(collapseID).classList.toggle("block");
  }

  /* Function for dropdowns */
  function openDropdown(event, dropdownID) {
    let element = event.target;
    while (element.nodeName !== "A") {
      element = element.parentNode;
    }
    document.getElementById(dropdownID).classList.toggle("hidden");
    document.getElementById(dropdownID).classList.toggle("block");
  }

  /* Function for show/hide table of content */
  function toggleTOC() {
    var toc = document.getElementById('toc');
        if (toc.style.display == "block"){ // if toc hidden, display it
            toc.style.display = "none";
        }
        else{ // if toc displayed, hidden it
            toc.style.display = "block";
        }
    }
</script>

</html>